

<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/hf-internal-interface-wrap/development/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/hf-internal-interface-wrap/development/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  

    .site-nav > ul.nav-list:first-child > li > a,
    .site-nav > ul.nav-list:first-child > li > ul > li > a,
    .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a,
    
    .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li:not(:nth-child(5)) > a,
    .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li > ul > li a {
      background-image: none;
    }

    .site-nav > ul.nav-list:not(:first-child) a,
    .site-nav li.external a {
      background-image: none;
    }

    .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(1) > ul > li:nth-child(3) > ul > li:nth-child(5) > a {
      font-weight: 600;
      text-decoration: none;
    }.site-nav > ul.nav-list:first-child > li:nth-child(1) > button svg,
    .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(1) > button svg,
    .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(1) > ul > li:nth-child(3) > button svg,
    .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(1) > ul > li:nth-child(3) > ul > li:nth-child(5) > button svg {
      transform: rotate(-90deg);
    }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list,
    .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list,
    .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list,
    .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list {
      display: block;
    }
  </style>

  

  
    <script src="/hf-internal-interface-wrap/development/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/hf-internal-interface-wrap/development/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>🔄 BaseSpi | HardFOC Interface Wrapper - development</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="🔄 BaseSpi" />
<meta name="author" content="N3b3x" />
<meta property="og:locale" content="en" />
<meta name="description" content="Serial Peripheral Interface base class for high-speed SPI communication" />
<meta property="og:description" content="Serial Peripheral Interface base class for high-speed SPI communication" />
<link rel="canonical" href="https://n3b3x.github.io/hf-internal-interface-wrap/development/docs/api/BaseSpi/" />
<meta property="og:url" content="https://n3b3x.github.io/hf-internal-interface-wrap/development/docs/api/BaseSpi/" />
<meta property="og:site_name" content="HardFOC Interface Wrapper - development" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="🔄 BaseSpi" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"N3b3x","url":"https://github.com/n3b3x"},"description":"Serial Peripheral Interface base class for high-speed SPI communication","headline":"🔄 BaseSpi","url":"https://n3b3x.github.io/hf-internal-interface-wrap/development/docs/api/BaseSpi/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Custom head content for hf-internal-interface-wrap documentation -->
<link rel="stylesheet" href="/hf-internal-interface-wrap/development/assets/css/custom.css">
<script src="/hf-internal-interface-wrap/development/assets/js/custom.js" defer></script>

<!-- Version selector for multi-version documentation -->
<!-- Version Selector Component for Multi-Version Documentation -->
<div class="version-selector">
  <div class="version-dropdown">
    <label for="version-select" class="version-label">
      <span class="version-icon">📚</span>
      Version:
    </label>
    <select id="version-select" class="version-select" onchange="switchVersion(this.value)">
      <option value="latest" data-url="/hf-internal-interface-wrap/">Development (main)</option>
      <option value="v2.1.0" data-url="/hf-internal-interface-wrap/v2.1.0/">v2.1.0 (Latest Stable)</option>
      <option value="v2.0.3" data-url="/hf-internal-interface-wrap/v2.0.3/">v2.0.3 (Previous Stable)</option>
      <option value="v2.1.0-rc1" data-url="/hf-internal-interface-wrap/v2.1.0-rc1/">v2.1.0-rc1 (Release Candidate)</option>
      <option value="v1.0.0" data-url="/hf-internal-interface-wrap/v1.0.0/">v1.0.0 (Legacy)</option>
    </select>
  </div>
  
  <div class="version-info">
    <span class="current-version" id="current-version">Latest (main)</span>
    <span class="version-badge" id="version-badge">dev</span>
  </div>
</div>

<script>
// Version switching logic
function switchVersion(version) {
  const select = document.getElementById('version-select');
  const selectedOption = select.options[select.selectedIndex];
  const targetUrl = selectedOption.getAttribute('data-url');
  
  if (targetUrl) {
    // Update current page URL to new version
    const currentPath = window.location.pathname;
    const baseUrl = window.location.origin;
    
    // Extract the path after the version prefix
    let newPath = currentPath;
    if (currentPath.includes('/hf-internal-interface-wrap/')) {
      const pathParts = currentPath.split('/hf-internal-interface-wrap/');
      if (pathParts.length > 1) {
        newPath = pathParts[1];
      }
    }
    
    // Construct new URL
    const newUrl = baseUrl + targetUrl + newPath;
    window.location.href = newUrl;
  }
}

// Set current version based on URL
document.addEventListener('DOMContentLoaded', function() {
  const currentPath = window.location.pathname;
  const versionSelect = document.getElementById('version-select');
  const currentVersionSpan = document.getElementById('current-version');
  const versionBadge = document.getElementById('version-badge');
  
  // Determine current version from URL
  let currentVersion = 'latest';
  let versionType = 'dev';
  
  if (currentPath.includes('/stable/')) {
    currentVersion = 'stable';
    versionType = 'stable';
  } else if (currentPath.includes('/v1.0.0/')) {
    currentVersion = 'v1.0.0';
    versionType = 'release';
  } else if (currentPath.includes('/v0.9.0/')) {
    currentVersion = 'v0.9.0';
    versionType = 'release';
  } else if (currentPath.includes('/v0.8.0/')) {
    currentVersion = 'v0.8.0';
    versionType = 'release';
  }
  
  // Update UI
  versionSelect.value = currentVersion;
  currentVersionSpan.textContent = currentVersion === 'latest' ? 'Latest (main)' : 
                                  currentVersion === 'stable' ? 'Stable (latest release)' : 
                                  currentVersion;
  
  // Update badge
  versionBadge.textContent = versionType;
  versionBadge.className = 'version-badge ' + versionType;
});
</script>

<style>
.version-selector {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem 1rem;
  background: var(--nav-child-link-bg);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  margin: 1rem 0;
  font-size: 0.9rem;
}

.version-dropdown {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.version-label {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-weight: 500;
  color: var(--body-text-color);
}

.version-icon {
  font-size: 1rem;
}

.version-select {
  padding: 0.25rem 0.5rem;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  background: var(--body-bg);
  color: var(--body-text-color);
  font-size: 0.9rem;
  min-width: 150px;
}

.version-select:focus {
  outline: 2px solid var(--link-color);
  outline-offset: 2px;
}

.version-info {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-left: auto;
}

.current-version {
  font-weight: 500;
  color: var(--body-text-color);
}

.version-badge {
  padding: 0.125rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
  text-transform: uppercase;
}

.version-badge.dev {
  background: #e3f2fd;
  color: #1976d2;
  border: 1px solid #bbdefb;
}

.version-badge.stable {
  background: #e8f5e8;
  color: #2e7d32;
  border: 1px solid #c8e6c9;
}

.version-badge.release {
  background: #fff3e0;
  color: #f57c00;
  border: 1px solid #ffcc02;
}

@media (max-width: 768px) {
  .version-selector {
    flex-direction: column;
    align-items: stretch;
    gap: 0.5rem;
  }
  
  .version-info {
    margin-left: 0;
    justify-content: center;
  }
}
</style>


<!-- Version information display -->
<!-- Version Information Display Component -->
<div class="version-info-display">
  <div class="version-details">
    <span class="version-label">Version:</span>
    <span class="version-value">1.0.0-dev</span>
    <span class="version-badge version-development">development</span>
  </div>
  
  <div class="version-meta">
    <span class="branch-info">
      <span class="branch-icon">🌿</span>
      <span class="branch-name">main</span>
    </span>
    
    <span class="build-info">
      <span class="build-icon">🔨</span>
      <span class="build-date">2025-09-17</span>
    </span>
  </div>
</div>

<style>
.version-info-display {
  background: var(--nav-child-link-bg);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 1rem;
  margin: 1rem 0;
  font-size: 0.9rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.version-details {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.version-label {
  font-weight: 500;
  color: var(--body-text-color);
}

.version-value {
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-weight: 600;
  color: var(--link-color);
  background: var(--code-bg);
  padding: 0.125rem 0.5rem;
  border-radius: 4px;
  border: 1px solid var(--border-color);
}

.version-badge {
  padding: 0.125rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.version-badge.development {
  background: #e3f2fd;
  color: #1976d2;
  border: 1px solid #bbdefb;
}

.version-badge.stable {
  background: #e8f5e8;
  color: #2e7d32;
  border: 1px solid #c8e6c9;
}

.version-badge.release {
  background: #fff3e0;
  color: #f57c00;
  border: 1px solid #ffcc02;
}

.version-meta {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.branch-info,
.build-info {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: var(--body-text-color);
  font-size: 0.85rem;
}

.branch-icon,
.build-icon {
  font-size: 0.9rem;
}

.branch-name {
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-weight: 500;
}

.build-date {
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-weight: 500;
}

@media (max-width: 768px) {
  .version-info-display {
    flex-direction: column;
    align-items: stretch;
    text-align: center;
  }
  
  .version-details,
  .version-meta {
    justify-content: center;
  }
  
  .version-meta {
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid var(--border-color);
  }
}
</style>



</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/hf-internal-interface-wrap/development/" class="site-title lh-tight">
  HardFOC Interface Wrapper - development

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 🔧 HardFOC Internal Interface Layer category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/hf-internal-interface-wrap/development/" class="nav-list-link">🔧 HardFOC Internal Interface Layer</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 📚 Documentation category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/hf-internal-interface-wrap/development/docs/" class="nav-list-link">📚 Documentation</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 🛠️ Utilities category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/hf-internal-interface-wrap/development/docs/utils/" class="nav-list-link">🛠️ Utilities</a><ul class="nav-list"><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/utils/DigitalOutputGuard/" class="nav-list-link">🛡️ DigitalOutputGuard</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/utils/AsciiArtGenerator/" class="nav-list-link">🎨 AsciiArtGenerator</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 🔧 ESP32 Implementations category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/hf-internal-interface-wrap/development/docs/esp_api/" class="nav-list-link">🔧 ESP32 Implementations</a><ul class="nav-list"><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspGpio/" class="nav-list-link">🔌 EspGpio</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspAdc/" class="nav-list-link">📊 EspAdc</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspPwm/" class="nav-list-link">🎛️ EspPwm</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspI2c/" class="nav-list-link">🔗 EspI2c</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspSpi/" class="nav-list-link">🔄 EspSpi</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspUart/" class="nav-list-link">📡 EspUart</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspCan/" class="nav-list-link">🚌 EspCan</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspWifi/" class="nav-list-link">📶 EspWifi</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspBluetooth/" class="nav-list-link">📲 EspBluetooth</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspNvs/" class="nav-list-link">💾 EspNvs</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspLogger/" class="nav-list-link">📝 EspLogger</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspPeriodicTimer/" class="nav-list-link">⏰ EspPeriodicTimer</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspPio/" class="nav-list-link">🎛️ EspPio</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspTemperature/" class="nav-list-link">🌡️ EspTemperature</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 📋 API Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/hf-internal-interface-wrap/development/docs/api/" class="nav-list-link">📋 API Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseGpio/" class="nav-list-link">🔌 BaseGpio</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseAdc/" class="nav-list-link">📊 BaseAdc</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BasePwm/" class="nav-list-link">🎛️ BasePwm</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseI2c/" class="nav-list-link">🔗 BaseI2c</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseSpi/" class="nav-list-link">🔄 BaseSpi</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseUart/" class="nav-list-link">📡 BaseUart</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseCan/" class="nav-list-link">🚌 BaseCan</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseWifi/" class="nav-list-link">📶 BaseWifi</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseBluetooth/" class="nav-list-link">📲 BaseBluetooth</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseNvs/" class="nav-list-link">💾 BaseNvs</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseLogger/" class="nav-list-link">📝 BaseLogger</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BasePeriodicTimer/" class="nav-list-link">⏰ BasePeriodicTimer</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BasePio/" class="nav-list-link">🎛️ BasePio</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/BaseTemperature/" class="nav-list-link">🌡️ BaseTemperature</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/HardwareTypes/" class="nav-list-link">🔧 HardwareTypes</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 🚀 ESP32 Examples category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/hf-internal-interface-wrap/development/examples/esp32/" class="nav-list-link">🚀 ESP32 Examples</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 🧪 Test Documentation category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/" class="nav-list-link">🧪 Test Documentation</a><ul class="nav-list"><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/gpio_test/" class="nav-list-link">🧪 GPIO Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/adc_test/" class="nav-list-link">🧪 ADC Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/pwm_test/" class="nav-list-link">🧪 PWM Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/pio_test/" class="nav-list-link">🧪 PIO Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/uart_test/" class="nav-list-link">🧪 UART Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/spi_test/" class="nav-list-link">🧪 SPI Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/i2c_test/" class="nav-list-link">🧪 I2C Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/can_test/" class="nav-list-link">🧪 CAN Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/wifi_test/" class="nav-list-link">🧪 WiFi Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/nvs_test/" class="nav-list-link">🧪 NVS Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/temperature_test/" class="nav-list-link">🧪 Temperature Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/logger_test/" class="nav-list-link">🧪 Logger Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/ascii_art_test/" class="nav-list-link">🧪 ASCII Art Test</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/dog_test/" class="nav-list-link">🧪 DOG Test</a></li></ul></li></ul></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/CONTRIBUTING/" class="nav-list-link">🤝 Contributing</a></li></ul></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/features/" class="nav-list-link">🚀 Features</a></li><li class="nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/doxygen-extensions.html" class="nav-list-link">📖 Doxygen Extensions</a></li></ul>
  
</nav>




  
  
    <footer class="site-nav-footer">
  <div class="nav-footer-links">
    <a href="https://github.com/n3b3x/hf-internal-interface-wrap" class="nav-footer-link" aria-label="GitHub Repository">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
      </svg>
      GitHub
    </a>
    <a href="https://github.com/n3b3x/hf-internal-interface-wrap/issues" class="nav-footer-link" aria-label="Report Issues">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
      Issues
    </a>
  </div>
</footer>

  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search workflows, examples, and guides..." aria-label="Search workflows, examples, and guides..." autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
    <nav aria-label="Auxiliary" class="aux-nav">
  <ul class="aux-nav-list">
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/n3b3x/hf-internal-interface-wrap" class="site-button"
          
        >
          📚 GitHub Repository
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/n3b3x/hf-internal-interface-wrap/issues" class="site-button"
          
        >
          🐛 Report Issues
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/n3b3x/hf-internal-interface-wrap/stargazers" class="site-button"
          
        >
          ⭐ Star on GitHub
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="/hf-internal-interface-wrap/api/index.html" class="site-button"
          
        >
          📖 API Reference
        </a>
      </li>
    
  </ul>
</nav>

  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
    <li class="breadcrumb-nav-list-item"><a href="/hf-internal-interface-wrap/development/">🔧 HardFOC Internal Interface Layer</a></li>
    <li class="breadcrumb-nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/">📚 Documentation</a></li>
    <li class="breadcrumb-nav-list-item"><a href="/hf-internal-interface-wrap/development/docs/api/">📋 API Reference</a></li>
    <li class="breadcrumb-nav-list-item"><span>🔄 BaseSpi</span></li>
  </ol>
</nav>


      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="-basespi-api-reference">
  
  
    <a href="#-basespi-api-reference" class="anchor-heading" aria-labelledby="-basespi-api-reference"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔌 BaseSpi API Reference
  
  
</h1>
    
<p><strong>🔄 Unified SPI abstraction for high-speed serial communication</strong></p>
<h2 id="-table-of-contents">
  
  
    <a href="#-table-of-contents" class="anchor-heading" aria-labelledby="-table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📚 <strong>Table of Contents</strong>
  
  
</h2>
    

<ul>
  <li><a href="#-overview">🎯 <strong>Overview</strong></a></li>
  <li><a href="#-class-hierarchy">🏗️ <strong>Class Hierarchy</strong></a></li>
  <li><a href="#-error-codes">📋 <strong>Error Codes</strong></a></li>
  <li><a href="#-core-api">🔧 <strong>Core API</strong></a></li>
  <li><a href="#-data-structures">📊 <strong>Data Structures</strong></a></li>
  <li><a href="#-usage-examples">📊 <strong>Usage Examples</strong></a></li>
  <li><a href="#-best-practices">🧪 <strong>Best Practices</strong></a></li>
</ul><hr />
<h2 id="-overview">
  
  
    <a href="#-overview" class="anchor-heading" aria-labelledby="-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🎯 <strong>Overview</strong>
  
  
</h2>
    

<p>The <code class="language-plaintext highlighter-rouge">BaseSpi</code> class provides a comprehensive SPI abstraction that serves as the unified interface
for all Serial Peripheral Interface operations in the HardFOC system.
It supports multi-device communication, configurable modes, and high-speed data transfer.</p>
<h3 id="-key-features">
  
  
    <a href="#-key-features" class="anchor-heading" aria-labelledby="-key-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ✨ <strong>Key Features</strong>
  
  
</h3>
    

<ul>
  <li>🔄 <strong>Multi-Device Support</strong> - Simultaneous communication with multiple SPI devices</li>
  <li>⚡ <strong>High-Speed Transfer</strong> - Configurable clock frequencies up to 80 MHz</li>
  <li>🎛️ <strong>Flexible Modes</strong> - Support for all SPI modes (0, 1, 2, 3)</li>
  <li>📊 <strong>DMA Support</strong> - Hardware-accelerated data transfer</li>
  <li>🛡️ <strong>Robust Error Handling</strong> - Comprehensive validation and error reporting</li>
  <li>🏎️ <strong>Performance Optimized</strong> - Minimal overhead for critical applications</li>
  <li>🔌 <strong>Platform Agnostic</strong> - Works with various SPI hardware implementations</li>
  <li>📈 <strong>Real-time Control</strong> - Low-latency communication for time-critical applications</li>
</ul>
<h3 id="-supported-applications">
  
  
    <a href="#-supported-applications" class="anchor-heading" aria-labelledby="-supported-applications"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔌 <strong>Supported Applications</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td>Application</td>
      <td>Speed</td>
      <td>Description</td>
    </tr>
  </tbody>
</table></div>

<p>|————-|——-|————-|</p>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><strong>Sensor Communication</strong></td>
      <td>1-10 MHz</td>
      <td>Temperature, pressure, IMU sensors</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><strong>Display Control</strong></td>
      <td>10-40 MHz</td>
      <td>LCD, OLED, TFT displays</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><strong>Memory Access</strong></td>
      <td>20-80 MHz</td>
      <td>Flash, EEPROM, FRAM</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><strong>Motor Control</strong></td>
      <td>1-20 MHz</td>
      <td>Motor driver ICs</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><strong>Audio Codecs</strong></td>
      <td>1-50 MHz</td>
      <td>Digital audio interfaces</td>
    </tr>
  </tbody>
</table></div><hr />
<h2 id="️-class-hierarchy">
  
  
    <a href="#️-class-hierarchy" class="anchor-heading" aria-labelledby="️-class-hierarchy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🏗️ <strong>Class Hierarchy</strong>
  
  
</h2>
    

<pre><code class="language-mermaid">classDiagram
    class BaseSpi {
        &lt;&lt;abstract&gt;&gt;
        +Initialize() hf_spi_err_t
        +Deinitialize() hf_spi_err_t
        +ConfigureDevice(device_id, config) hf_spi_err_t
        +TransmitReceive(device_id, tx_data, rx_data, length) hf_spi_err_t
        +Transmit(device_id, data, length) hf_spi_err_t
        +Receive(device_id, data, length) hf_spi_err_t
        +GetDeviceStatus(device_id, status) hf_spi_err_t
        +GetCapabilities(capabilities) hf_spi_err_t
    }
    
    class EspSpi {
        +EspSpi(host, cs_pin)
        +GetHost() spi_host_device_t
        +GetCsPin() hf_pin_num_t
    }
    
    BaseSpi &lt;|-- EspSpi
</code></pre><hr />
<h2 id="-error-codes">
  
  
    <a href="#-error-codes" class="anchor-heading" aria-labelledby="-error-codes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📋 <strong>Error Codes</strong>
  
  
</h2>
    
<h3 id="-success-codes">
  
  
    <a href="#-success-codes" class="anchor-heading" aria-labelledby="-success-codes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ✅ <strong>Success Codes</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td>Code</td>
      <td>Value</td>
      <td>Description</td>
    </tr>
  </tbody>
</table></div>

<p>|——|——-|————-|</p>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_SUCCESS</code></td>
      <td>0</td>
      <td>✅ Operation completed successfully</td>
    </tr>
  </tbody>
</table></div>
<h3 id="-general-error-codes">
  
  
    <a href="#-general-error-codes" class="anchor-heading" aria-labelledby="-general-error-codes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ❌ <strong>General Error Codes</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td>Code</td>
      <td>Value</td>
      <td>Description</td>
      <td>Resolution</td>
    </tr>
  </tbody>
</table></div>

<p>|——|——-|————-|————|</p>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_FAILURE</code></td>
      <td>1</td>
      <td>❌ General operation failure</td>
      <td>Check hardware and configuration</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_NOT_INITIALIZED</code></td>
      <td>2</td>
      <td>⚠️ SPI not initialized</td>
      <td>Call Initialize() first</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_ALREADY_INITIALIZED</code></td>
      <td>3</td>
      <td>⚠️ SPI already initialized</td>
      <td>Check initialization state</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_INVALID_PARAMETER</code></td>
      <td>4</td>
      <td>🚫 Invalid parameter</td>
      <td>Validate input parameters</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_NULL_POINTER</code></td>
      <td>5</td>
      <td>🚫 Null pointer provided</td>
      <td>Check pointer validity</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_OUT_OF_MEMORY</code></td>
      <td>6</td>
      <td>💾 Memory allocation failed</td>
      <td>Check system memory</td>
    </tr>
  </tbody>
</table></div>
<h3 id="-device-error-codes">
  
  
    <a href="#-device-error-codes" class="anchor-heading" aria-labelledby="-device-error-codes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔧 <strong>Device Error Codes</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td>Code</td>
      <td>Value</td>
      <td>Description</td>
      <td>Resolution</td>
    </tr>
  </tbody>
</table></div>

<p>|——|——-|————-|————|</p>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_INVALID_DEVICE</code></td>
      <td>7</td>
      <td>🚫 Invalid SPI device</td>
      <td>Use valid device numbers</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_DEVICE_BUSY</code></td>
      <td>8</td>
      <td>🔄 Device already in use</td>
      <td>Wait or use different device</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_DEVICE_NOT_AVAILABLE</code></td>
      <td>9</td>
      <td>⚠️ Device not available</td>
      <td>Check device availability</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_DEVICE_NOT_CONFIGURED</code></td>
      <td>10</td>
      <td>⚙️ Device not configured</td>
      <td>Configure device first</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_DEVICE_NOT_RESPONDING</code></td>
      <td>11</td>
      <td>🔇 Device not responding</td>
      <td>Check device power</td>
    </tr>
  </tbody>
</table></div>
<h3 id="-transfer-error-codes">
  
  
    <a href="#-transfer-error-codes" class="anchor-heading" aria-labelledby="-transfer-error-codes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ⚡ <strong>Transfer Error Codes</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td>Code</td>
      <td>Value</td>
      <td>Description</td>
      <td>Resolution</td>
    </tr>
  </tbody>
</table></div>

<p>|——|——-|————-|————|</p>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_TRANSFER_TIMEOUT</code></td>
      <td>12</td>
      <td>⏰ Transfer timeout</td>
      <td>Check clock frequency and device</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_TRANSFER_FAILURE</code></td>
      <td>13</td>
      <td>❌ Transfer failed</td>
      <td>Check connections and device state</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_TRANSFER_INCOMPLETE</code></td>
      <td>14</td>
      <td>📊 Transfer incomplete</td>
      <td>Check data length and buffer size</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_TRANSFER_ABORTED</code></td>
      <td>15</td>
      <td>⏹️ Transfer aborted</td>
      <td>Check abort conditions</td>
    </tr>
  </tbody>
</table></div>
<h3 id="️-configuration-error-codes">
  
  
    <a href="#️-configuration-error-codes" class="anchor-heading" aria-labelledby="️-configuration-error-codes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🎛️ <strong>Configuration Error Codes</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td>Code</td>
      <td>Value</td>
      <td>Description</td>
      <td>Resolution</td>
    </tr>
  </tbody>
</table></div>

<p>|——|——-|————-|————|</p>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_INVALID_CONFIGURATION</code></td>
      <td>16</td>
      <td>⚙️ Invalid configuration</td>
      <td>Check configuration parameters</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_UNSUPPORTED_MODE</code></td>
      <td>17</td>
      <td>🚫 Unsupported SPI mode</td>
      <td>Use supported mode</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_UNSUPPORTED_FREQUENCY</code></td>
      <td>18</td>
      <td>🚫 Unsupported frequency</td>
      <td>Use supported frequency range</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_UNSUPPORTED_DATA_SIZE</code></td>
      <td>19</td>
      <td>🚫 Unsupported data size</td>
      <td>Use supported data size</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_PIN_CONFLICT</code></td>
      <td>20</td>
      <td>🔌 Pin already in use</td>
      <td>Use different pins</td>
    </tr>
  </tbody>
</table></div>
<h3 id="-hardware-error-codes">
  
  
    <a href="#-hardware-error-codes" class="anchor-heading" aria-labelledby="-hardware-error-codes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🌐 <strong>Hardware Error Codes</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td>Code</td>
      <td>Value</td>
      <td>Description</td>
      <td>Resolution</td>
    </tr>
  </tbody>
</table></div>

<p>|——|——-|————-|————|</p>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_HARDWARE_FAULT</code></td>
      <td>21</td>
      <td>💥 Hardware fault</td>
      <td>Check power and connections</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_COMMUNICATION_FAILURE</code></td>
      <td>22</td>
      <td>📡 Communication failure</td>
      <td>Check bus connections</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_DMA_ERROR</code></td>
      <td>23</td>
      <td>💾 DMA error</td>
      <td>Check DMA configuration</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SPI_ERR_RESOURCE_BUSY</code></td>
      <td>24</td>
      <td>🔄 Resource busy</td>
      <td>Wait for resource availability</td>
    </tr>
  </tbody>
</table></div><hr />
<h2 id="-core-api">
  
  
    <a href="#-core-api" class="anchor-heading" aria-labelledby="-core-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔧 <strong>Core API</strong>
  
  
</h2>
    
<h3 id="️-initialization-methods">
  
  
    <a href="#️-initialization-methods" class="anchor-heading" aria-labelledby="️-initialization-methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🏗️ <strong>Initialization Methods</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * @brief Initialize the SPI peripheral
 * @return hf_spi_err_t error code
 * 
 * 📝 Sets up SPI hardware, configures devices, and prepares for communication.
 * Must be called before any SPI operations.
 * 
 * @example
 * EspSpi spi(SPI2_HOST, 5);  // SPI2, CS on pin 5
 * hf_spi_err_t result = spi.Initialize();
 * if (result == hf_spi_err_t::SPI_SUCCESS) {
 *     // SPI ready for use
 * }
 */</span>
<span class="k">virtual</span> <span class="n">hf_spi_err_t</span> <span class="n">Initialize</span><span class="p">()</span> <span class="k">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/**
 * @brief Deinitialize the SPI peripheral
 * @return hf_spi_err_t error code
 * 
 * 🧹 Cleanly shuts down SPI hardware and releases resources.
 */</span>
<span class="k">virtual</span> <span class="n">hf_spi_err_t</span> <span class="n">Deinitialize</span><span class="p">()</span> <span class="k">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/**
 * @brief Check if SPI is initialized
 * @return true if initialized, false otherwise
 * 
 * ❓ Query initialization status without side effects.
 */</span>
<span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kt">bool</span> <span class="n">IsInitialized</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>

<span class="cm">/**
 * @brief Ensure SPI is initialized (lazy initialization)
 * @return true if initialized successfully, false otherwise
 * 
 * 🔄 Automatically initializes SPI if not already initialized.
 */</span>
<span class="kt">bool</span> <span class="n">EnsureInitialized</span><span class="p">()</span> <span class="k">noexcept</span><span class="p">;</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="️-device-configuration">
  
  
    <a href="#️-device-configuration" class="anchor-heading" aria-labelledby="️-device-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ⚙️ <strong>Device Configuration</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * @brief Configure an SPI device
 * @param device_id Device identifier
 * @param config Device configuration structure
 * @return hf_spi_err_t error code
 * 
 * ⚙️ Configures device parameters including mode, frequency, data size,
 * and pin assignments.
 * 
 * @example
 * hf_spi_device_config_t config;
 * config.mode = hf_spi_mode_t::MODE_0;
 * config.frequency_hz = 1000000;  // 1 MHz
 * config.data_size = hf_spi_data_size_t::DATA_8BIT;
 * config.cs_pin = 5;
 * config.cs_active_low = true;
 * 
 * hf_spi_err_t result = spi.ConfigureDevice(0, config);
 */</span>
<span class="k">virtual</span> <span class="n">hf_spi_err_t</span> <span class="n">ConfigureDevice</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">device_id</span><span class="p">,</span>
                                   <span class="k">const</span> <span class="n">hf_spi_device_config_t</span> <span class="o">&amp;</span><span class="n">config</span><span class="p">)</span> <span class="k">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="-data-transfer-methods">
  
  
    <a href="#-data-transfer-methods" class="anchor-heading" aria-labelledby="-data-transfer-methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔄 <strong>Data Transfer Methods</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * @brief Transmit and receive data simultaneously
 * @param device_id Device identifier
 * @param tx_data Transmit data buffer
 * @param rx_data Receive data buffer
 * @param length Number of bytes to transfer
 * @return hf_spi_err_t error code
 * 
 * 🔄 Performs full-duplex SPI transfer. Both transmit and receive
 * buffers must be at least 'length' bytes.
 * 
 * @example
 * uint8_t tx_data[] = {0x01, 0x02, 0x03};
 * uint8_t rx_data[3];
 * hf_spi_err_t result = spi.TransmitReceive(0, tx_data, rx_data, 3);
 * if (result == hf_spi_err_t::SPI_SUCCESS) {
 *     printf("Received: %02X %02X %02X\n", rx_data[0], rx_data[1], rx_data[2]);
 * }
 */</span>
<span class="k">virtual</span> <span class="n">hf_spi_err_t</span> <span class="n">TransmitReceive</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">device_id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">tx_data</span><span class="p">,</span>
                                   <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">rx_data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span> <span class="k">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/**
 * @brief Transmit data only
 * @param device_id Device identifier
 * @param data Transmit data buffer
 * @param length Number of bytes to transmit
 * @return hf_spi_err_t error code
 * 
 * 📤 Performs SPI transmit operation. Receive data is discarded.
 * 
 * @example
 * uint8_t command[] = {0xAA, 0x55, 0x01};
 * hf_spi_err_t result = spi.Transmit(0, command, 3);
 */</span>
<span class="k">virtual</span> <span class="n">hf_spi_err_t</span> <span class="n">Transmit</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">device_id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
                            <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span> <span class="k">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/**
 * @brief Receive data only
 * @param device_id Device identifier
 * @param data Receive data buffer
 * @param length Number of bytes to receive
 * @return hf_spi_err_t error code
 * 
 * 📥 Performs SPI receive operation. Transmit data is zeros.
 * 
 * @example
 * uint8_t response[4];
 * hf_spi_err_t result = spi.Receive(0, response, 4);
 */</span>
<span class="k">virtual</span> <span class="n">hf_spi_err_t</span> <span class="n">Receive</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">device_id</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
                           <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span> <span class="k">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="-status-and-capabilities">
  
  
    <a href="#-status-and-capabilities" class="anchor-heading" aria-labelledby="-status-and-capabilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📊 <strong>Status and Capabilities</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * @brief Get device status information
 * @param device_id Device identifier
 * @param status [out] Status information structure
 * @return hf_spi_err_t error code
 * 
 * 📊 Retrieves comprehensive status information about a device.
 */</span>
<span class="k">virtual</span> <span class="n">hf_spi_err_t</span> <span class="n">GetDeviceStatus</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">device_id</span><span class="p">,</span>
                                   <span class="n">hf_spi_device_status_t</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">)</span> <span class="k">const</span> <span class="k">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/**
 * @brief Get SPI capabilities
 * @param capabilities [out] Capability information structure
 * @return hf_spi_err_t error code
 * 
 * 📋 Retrieves hardware capabilities and limitations.
 */</span>
<span class="k">virtual</span> <span class="n">hf_spi_err_t</span> <span class="n">GetCapabilities</span><span class="p">(</span><span class="n">hf_spi_capabilities_t</span> <span class="o">&amp;</span><span class="n">capabilities</span><span class="p">)</span> <span class="k">const</span> <span class="k">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="-data-structures">
  
  
    <a href="#-data-structures" class="anchor-heading" aria-labelledby="-data-structures"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📊 <strong>Data Structures</strong>
  
  
</h2>
    
<h3 id="️-device-configuration-1">
  
  
    <a href="#️-device-configuration-1" class="anchor-heading" aria-labelledby="️-device-configuration-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ⚙️ <strong>Device Configuration</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">hf_spi_device_config_t</span> <span class="p">{</span>
    <span class="n">hf_spi_mode_t</span> <span class="n">mode</span><span class="p">;</span>              <span class="c1">///&lt; SPI mode (0-3)</span>
    <span class="kt">uint32_t</span> <span class="n">frequency_hz</span><span class="p">;</span>           <span class="c1">///&lt; Clock frequency in Hz</span>
    <span class="n">hf_spi_data_size_t</span> <span class="n">data_size</span><span class="p">;</span>    <span class="c1">///&lt; Data size (8, 16, 32 bit)</span>
    <span class="n">hf_pin_num_t</span> <span class="n">cs_pin</span><span class="p">;</span>             <span class="c1">///&lt; Chip select pin</span>
    <span class="kt">bool</span> <span class="n">cs_active_low</span><span class="p">;</span>              <span class="c1">///&lt; CS active low (true) or high (false)</span>
    <span class="n">hf_spi_bit_order_t</span> <span class="n">bit_order</span><span class="p">;</span>    <span class="c1">///&lt; Bit order (MSB or LSB first)</span>
    <span class="kt">uint32_t</span> <span class="n">timeout_ms</span><span class="p">;</span>             <span class="c1">///&lt; Transfer timeout in milliseconds</span>
    <span class="kt">bool</span> <span class="n">use_dma</span><span class="p">;</span>                    <span class="c1">///&lt; Use DMA for transfers</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="-device-status">
  
  
    <a href="#-device-status" class="anchor-heading" aria-labelledby="-device-status"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📊 <strong>Device Status</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">hf_spi_device_status_t</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="n">is_configured</span><span class="p">;</span>        <span class="c1">///&lt; Device is configured</span>
    <span class="kt">bool</span> <span class="n">is_busy</span><span class="p">;</span>              <span class="c1">///&lt; Device is currently busy</span>
    <span class="n">hf_spi_mode_t</span> <span class="n">current_mode</span><span class="p">;</span> <span class="c1">///&lt; Current SPI mode</span>
    <span class="kt">uint32_t</span> <span class="n">current_frequency</span><span class="p">;</span> <span class="c1">///&lt; Current frequency in Hz</span>
    <span class="kt">uint32_t</span> <span class="n">bytes_transferred</span><span class="p">;</span> <span class="c1">///&lt; Total bytes transferred</span>
    <span class="kt">uint32_t</span> <span class="n">transfer_errors</span><span class="p">;</span>   <span class="c1">///&lt; Number of transfer errors</span>
    <span class="n">hf_spi_err_t</span> <span class="n">last_error</span><span class="p">;</span>    <span class="c1">///&lt; Last error that occurred</span>
    <span class="kt">uint32_t</span> <span class="n">timestamp_us</span><span class="p">;</span>      <span class="c1">///&lt; Timestamp of last operation</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="-spi-capabilities">
  
  
    <a href="#-spi-capabilities" class="anchor-heading" aria-labelledby="-spi-capabilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📋 <strong>SPI Capabilities</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">hf_spi_capabilities_t</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">max_devices</span><span class="p">;</span>           <span class="c1">///&lt; Maximum number of devices</span>
    <span class="kt">uint32_t</span> <span class="n">min_frequency_hz</span><span class="p">;</span>     <span class="c1">///&lt; Minimum frequency</span>
    <span class="kt">uint32_t</span> <span class="n">max_frequency_hz</span><span class="p">;</span>     <span class="c1">///&lt; Maximum frequency</span>
    <span class="kt">uint8_t</span> <span class="n">supported_modes</span><span class="p">;</span>       <span class="c1">///&lt; Bit mask of supported modes</span>
    <span class="kt">uint8_t</span> <span class="n">supported_data_sizes</span><span class="p">;</span>  <span class="c1">///&lt; Bit mask of supported data sizes</span>
    <span class="kt">bool</span> <span class="n">supports_dma</span><span class="p">;</span>             <span class="c1">///&lt; Supports DMA transfers</span>
    <span class="kt">bool</span> <span class="n">supports_quad_spi</span><span class="p">;</span>        <span class="c1">///&lt; Supports quad SPI</span>
    <span class="kt">uint32_t</span> <span class="n">max_transfer_size</span><span class="p">;</span>    <span class="c1">///&lt; Maximum transfer size in bytes</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="-spi-statistics">
  
  
    <a href="#-spi-statistics" class="anchor-heading" aria-labelledby="-spi-statistics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📈 <strong>SPI Statistics</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">hf_spi_statistics_t</span> <span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">total_transfers</span><span class="p">;</span>      <span class="c1">///&lt; Total transfers performed</span>
    <span class="kt">uint32_t</span> <span class="n">successful_transfers</span><span class="p">;</span> <span class="c1">///&lt; Successful transfers</span>
    <span class="kt">uint32_t</span> <span class="n">failed_transfers</span><span class="p">;</span>     <span class="c1">///&lt; Failed transfers</span>
    <span class="kt">uint32_t</span> <span class="n">bytes_transmitted</span><span class="p">;</span>    <span class="c1">///&lt; Total bytes transmitted</span>
    <span class="kt">uint32_t</span> <span class="n">bytes_received</span><span class="p">;</span>       <span class="c1">///&lt; Total bytes received</span>
    <span class="kt">uint32_t</span> <span class="n">average_transfer_time_us</span><span class="p">;</span> <span class="c1">///&lt; Average transfer time</span>
    <span class="kt">uint32_t</span> <span class="n">max_transfer_time_us</span><span class="p">;</span> <span class="c1">///&lt; Maximum transfer time</span>
    <span class="kt">uint32_t</span> <span class="n">min_transfer_time_us</span><span class="p">;</span> <span class="c1">///&lt; Minimum transfer time</span>
    <span class="kt">uint32_t</span> <span class="n">timeout_errors</span><span class="p">;</span>       <span class="c1">///&lt; Timeout errors</span>
    <span class="kt">uint32_t</span> <span class="n">communication_errors</span><span class="p">;</span> <span class="c1">///&lt; Communication errors</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="-usage-examples">
  
  
    <a href="#-usage-examples" class="anchor-heading" aria-labelledby="-usage-examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📊 <strong>Usage Examples</strong>
  
  
</h2>
    
<h3 id="-sensor-communication">
  
  
    <a href="#-sensor-communication" class="anchor-heading" aria-labelledby="-sensor-communication"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📡 <strong>Sensor Communication</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"mcu/esp32/EspSpi.h"</span><span class="cp">
#include</span> <span class="cpf">"utils/memory_utils.h"</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">SensorController</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">EspSpi</span> <span class="n">spi</span><span class="o">*</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">uint8_t</span> <span class="n">SENSOR_DEVICE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    
<span class="nl">public:</span>
    <span class="kt">bool</span> <span class="n">initialize</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">spi</span><span class="o">*</span> <span class="o">=</span> <span class="n">EspSpi</span><span class="p">(</span><span class="n">SPI2_HOST</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>  <span class="c1">// SPI2, CS on pin 5</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">EnsureInitialized</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ SPI initialization failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Configure for sensor communication</span>
        <span class="n">hf_spi_device_config_t</span> <span class="n">config</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">hf_spi_mode_t</span><span class="o">::</span><span class="n">MODE_0</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">frequency_hz</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>  <span class="c1">// 1 MHz</span>
        <span class="n">config</span><span class="p">.</span><span class="n">data_size</span> <span class="o">=</span> <span class="n">hf_spi_data_size_t</span><span class="o">::</span><span class="n">DATA_8BIT</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">cs_pin</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">cs_active_low</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">bit_order</span> <span class="o">=</span> <span class="n">hf_spi_bit_order_t</span><span class="o">::</span><span class="n">MSB_FIRST</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">timeout_ms</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">use_dma</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">ConfigureDevice</span><span class="p">(</span><span class="n">SENSOR_DEVICE</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Sensor configuration failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">printf</span><span class="p">(</span><span class="s">"✅ Sensor controller initialized</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kt">uint16_t</span> <span class="n">read_temperature</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Send temperature read command</span>
        <span class="kt">uint8_t</span> <span class="n">tx_cmd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">};</span>  <span class="c1">// Read temperature command</span>
        <span class="kt">uint8_t</span> <span class="n">rx_data</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
        
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">SENSOR_DEVICE</span><span class="p">,</span> <span class="n">tx_cmd</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Temperature read failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
            <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>  <span class="c1">// Error value</span>
        <span class="p">}</span>
        
        <span class="c1">// Convert response to temperature (example conversion)</span>
        <span class="kt">uint16_t</span> <span class="n">raw_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">rx_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">rx_data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="kt">float</span> <span class="n">temperature</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_temp</span> <span class="o">*</span> <span class="mf">175.0</span><span class="n">f</span> <span class="o">/</span> <span class="mf">65535.0</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mf">45.0</span><span class="n">f</span><span class="p">;</span>
        
        <span class="n">printf</span><span class="p">(</span><span class="s">"🌡️ Temperature: %.1f°C</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">temperature</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">raw_temp</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">write_config</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">config_register</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Send configuration write command</span>
        <span class="kt">uint8_t</span> <span class="n">tx_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">config_register</span><span class="p">,</span> <span class="n">value</span><span class="p">};</span>  <span class="c1">// Write command</span>
        <span class="kt">uint8_t</span> <span class="n">rx_data</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
        
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">SENSOR_DEVICE</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"✅ Config written: 0x%02X = 0x%02X</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">config_register</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Config write failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">read_sensor_data</span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Read sensor data using nothrow allocation</span>
        <span class="kt">uint8_t</span> <span class="n">tx_cmd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">};</span>  <span class="c1">// Read data command</span>
        <span class="k">auto</span> <span class="n">rx_data</span> <span class="o">=</span> <span class="n">hf</span><span class="o">::</span><span class="n">utils</span><span class="o">::</span><span class="n">make_unique_array_nothrow</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">length</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rx_data</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Failed to allocate memory for receive buffer</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">SENSOR_DEVICE</span><span class="p">,</span> <span class="n">tx_cmd</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">length</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Copy data (skip command bytes)</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"📊 Read %zu bytes of sensor data</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Sensor data read failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
        <span class="p">}</span>
        
        <span class="c1">// rx_data automatically cleaned up when going out of scope</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="️-display-control">
  
  
    <a href="#️-display-control" class="anchor-heading" aria-labelledby="️-display-control"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🖥️ <strong>Display Control</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"mcu/esp32/EspSpi.h"</span><span class="cp">
#include</span> <span class="cpf">"utils/memory_utils.h"</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">DisplayController</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">EspSpi</span> <span class="n">spi</span><span class="o">*</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">uint8_t</span> <span class="n">DISPLAY_DEVICE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">uint16_t</span> <span class="n">DISPLAY_WIDTH</span> <span class="o">=</span> <span class="mi">240</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">uint16_t</span> <span class="n">DISPLAY_HEIGHT</span> <span class="o">=</span> <span class="mi">320</span><span class="p">;</span>
    
<span class="nl">public:</span>
    <span class="kt">bool</span> <span class="n">initialize</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">spi</span><span class="o">*</span> <span class="o">=</span> <span class="n">EspSpi</span><span class="p">(</span><span class="n">SPI2_HOST</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span>  <span class="c1">// SPI2, CS on pin 15</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">EnsureInitialized</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Configure for display communication</span>
        <span class="n">hf_spi_device_config_t</span> <span class="n">config</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">hf_spi_mode_t</span><span class="o">::</span><span class="n">MODE_0</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">frequency_hz</span> <span class="o">=</span> <span class="mi">40000000</span><span class="p">;</span>  <span class="c1">// 40 MHz for display</span>
        <span class="n">config</span><span class="p">.</span><span class="n">data_size</span> <span class="o">=</span> <span class="n">hf_spi_data_size_t</span><span class="o">::</span><span class="n">DATA_8BIT</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">cs_pin</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">cs_active_low</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">bit_order</span> <span class="o">=</span> <span class="n">hf_spi_bit_order_t</span><span class="o">::</span><span class="n">MSB_FIRST</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">timeout_ms</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">use_dma</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>  <span class="c1">// Use DMA for large transfers</span>
        
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">ConfigureDevice</span><span class="p">(</span><span class="n">DISPLAY_DEVICE</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Display configuration failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Initialize display</span>
        <span class="n">init_display</span><span class="p">();</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"✅ Display controller initialized</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    
<span class="nl">private:</span>
    <span class="kt">void</span> <span class="n">init_display</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Display initialization sequence</span>
        <span class="kt">uint8_t</span> <span class="n">init_commands</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>  <span class="c1">// Software reset</span>
            <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>  <span class="c1">// Sleep out</span>
            <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x00</span>   <span class="c1">// Display on</span>
        <span class="p">};</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">init_commands</span><span class="p">);</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">send_command</span><span class="p">(</span><span class="n">init_commands</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">init_commands</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">send_data</span><span class="p">(</span><span class="o">&amp;</span><span class="n">init_commands</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">vTaskDelay</span><span class="p">(</span><span class="n">pdMS_TO_TICKS</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">send_command</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">command</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Set DC pin low for command</span>
        <span class="n">gpio_set_level</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>  <span class="c1">// DC pin on GPIO 16</span>
        
        <span class="kt">uint8_t</span> <span class="n">rx_data</span><span class="p">;</span>
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">DISPLAY_DEVICE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">command</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rx_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Command send failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">send_data</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Set DC pin high for data</span>
        <span class="n">gpio_set_level</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>  <span class="c1">// DC pin on GPIO 16</span>
        
        <span class="k">auto</span> <span class="n">rx_data</span> <span class="o">=</span> <span class="n">hf</span><span class="o">::</span><span class="n">utils</span><span class="o">::</span><span class="n">make_unique_array_nothrow</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">length</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rx_data</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Failed to allocate memory for receive buffer</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">DISPLAY_DEVICE</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">length</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Data send failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
        <span class="p">}</span>
        
        <span class="c1">// rx_data automatically cleaned up when going out of scope</span>
    <span class="p">}</span>
    
<span class="nl">public:</span>
    <span class="kt">void</span> <span class="n">set_window</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">x_start</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">y_start</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">x_end</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">y_end</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Set display window for drawing</span>
        <span class="kt">uint8_t</span> <span class="n">caset_cmd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x2A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">(</span><span class="n">x_start</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="n">x_start</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
                              <span class="mh">0x00</span><span class="p">,</span> <span class="p">(</span><span class="n">x_end</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="n">x_end</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">};</span>
        <span class="kt">uint8_t</span> <span class="n">raset_cmd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">(</span><span class="n">y_start</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="n">y_start</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
                              <span class="mh">0x00</span><span class="p">,</span> <span class="p">(</span><span class="n">y_end</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="n">y_end</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">};</span>
        
        <span class="n">send_command</span><span class="p">(</span><span class="mh">0x2A</span><span class="p">);</span>  <span class="c1">// Column address set</span>
        <span class="n">send_data</span><span class="p">(</span><span class="n">caset_cmd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
        
        <span class="n">send_command</span><span class="p">(</span><span class="mh">0x2B</span><span class="p">);</span>  <span class="c1">// Row address set</span>
        <span class="n">send_data</span><span class="p">(</span><span class="n">raset_cmd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
        
        <span class="n">send_command</span><span class="p">(</span><span class="mh">0x2C</span><span class="p">);</span>  <span class="c1">// Memory write</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">fill_screen</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">color</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">set_window</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DISPLAY_WIDTH</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DISPLAY_HEIGHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        
        <span class="c1">// Prepare color data</span>
        <span class="kt">uint8_t</span> <span class="n">color_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{(</span><span class="n">color</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="n">color</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">};</span>
        
        <span class="c1">// Fill screen with color</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DISPLAY_WIDTH</span> <span class="o">*</span> <span class="n">DISPLAY_HEIGHT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">send_data</span><span class="p">(</span><span class="n">color_data</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="n">draw_pixel</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">x</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">y</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">color</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">set_window</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
        
        <span class="kt">uint8_t</span> <span class="n">color_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{(</span><span class="n">color</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="n">color</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">};</span>
        <span class="n">send_data</span><span class="p">(</span><span class="n">color_data</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="-memory-access">
  
  
    <a href="#-memory-access" class="anchor-heading" aria-labelledby="-memory-access"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 💾 <strong>Memory Access</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"mcu/esp32/EspSpi.h"</span><span class="cp">
#include</span> <span class="cpf">"utils/memory_utils.h"</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">MemoryController</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">EspSpi</span> <span class="n">spi</span><span class="o">*</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">uint8_t</span> <span class="n">MEMORY_DEVICE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">uint32_t</span> <span class="n">MEMORY_SIZE</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span>  <span class="c1">// 1MB</span>
    
<span class="nl">public:</span>
    <span class="kt">bool</span> <span class="n">initialize</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">spi</span><span class="o">*</span> <span class="o">=</span> <span class="n">EspSpi</span><span class="p">(</span><span class="n">SPI2_HOST</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>  <span class="c1">// SPI2, CS on pin 5</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">EnsureInitialized</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Configure for memory access</span>
        <span class="n">hf_spi_device_config_t</span> <span class="n">config</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">hf_spi_mode_t</span><span class="o">::</span><span class="n">MODE_0</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">frequency_hz</span> <span class="o">=</span> <span class="mi">80000000</span><span class="p">;</span>  <span class="c1">// 80 MHz for fast memory access</span>
        <span class="n">config</span><span class="p">.</span><span class="n">data_size</span> <span class="o">=</span> <span class="n">hf_spi_data_size_t</span><span class="o">::</span><span class="n">DATA_8BIT</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">cs_pin</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">cs_active_low</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">bit_order</span> <span class="o">=</span> <span class="n">hf_spi_bit_order_t</span><span class="o">::</span><span class="n">MSB_FIRST</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">timeout_ms</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">config</span><span class="p">.</span><span class="n">use_dma</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">ConfigureDevice</span><span class="p">(</span><span class="n">MEMORY_DEVICE</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Memory configuration failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">printf</span><span class="p">(</span><span class="s">"✅ Memory controller initialized</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kt">bool</span> <span class="n">read_memory</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">address</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Send read command using nothrow allocation</span>
        <span class="kt">uint8_t</span> <span class="n">tx_cmd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="p">(</span><span class="n">address</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="p">(</span><span class="n">address</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="n">address</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">};</span>
        <span class="k">auto</span> <span class="n">rx_data</span> <span class="o">=</span> <span class="n">hf</span><span class="o">::</span><span class="n">utils</span><span class="o">::</span><span class="n">make_unique_array_nothrow</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">length</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rx_data</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Failed to allocate memory for receive buffer</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">MEMORY_DEVICE</span><span class="p">,</span> <span class="n">tx_cmd</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">length</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Copy data (skip command bytes)</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"📖 Read %zu bytes from address 0x%06X</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">address</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Memory read failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// rx_data automatically cleaned up when going out of scope</span>
    <span class="p">}</span>
    
    <span class="kt">bool</span> <span class="n">write_memory</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">address</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Send write enable command</span>
        <span class="kt">uint8_t</span> <span class="n">write_enable</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
        <span class="kt">uint8_t</span> <span class="n">rx_data</span><span class="p">;</span>
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">MEMORY_DEVICE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">write_enable</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rx_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Write enable failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Send write command using nothrow allocation</span>
        <span class="k">auto</span> <span class="n">tx_data</span> <span class="o">=</span> <span class="n">hf</span><span class="o">::</span><span class="n">utils</span><span class="o">::</span><span class="n">make_unique_array_nothrow</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">length</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tx_data</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Failed to allocate memory for transmit buffer</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">tx_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>  <span class="c1">// Page program command</span>
        <span class="n">tx_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">address</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">tx_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">address</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">tx_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">address</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">tx_data</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">Transmit</span><span class="p">(</span><span class="n">MEMORY_DEVICE</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">length</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"✍️ Wrote %zu bytes to address 0x%06X</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">address</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Memory write failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// tx_data automatically cleaned up when going out of scope</span>
    <span class="p">}</span>
    
    <span class="kt">bool</span> <span class="n">erase_sector</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">address</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Send write enable command</span>
        <span class="kt">uint8_t</span> <span class="n">write_enable</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
        <span class="kt">uint8_t</span> <span class="n">rx_data</span><span class="p">;</span>
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">MEMORY_DEVICE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">write_enable</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rx_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Write enable failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Send sector erase command</span>
        <span class="kt">uint8_t</span> <span class="n">erase_cmd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="p">(</span><span class="n">address</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="p">(</span><span class="n">address</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="n">address</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">};</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">Transmit</span><span class="p">(</span><span class="n">MEMORY_DEVICE</span><span class="p">,</span> <span class="n">erase_cmd</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"🗑️ Erased sector at address 0x%06X</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">address</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Sector erase failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kt">uint32_t</span> <span class="n">read_device_id</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">uint8_t</span> <span class="n">tx_cmd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">};</span>  <span class="c1">// Read ID command</span>
        <span class="kt">uint8_t</span> <span class="n">rx_data</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
        
        <span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="o">*</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">MEMORY_DEVICE</span><span class="p">,</span> <span class="n">tx_cmd</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint32_t</span> <span class="n">device_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">rx_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">rx_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">rx_data</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"🆔 Device ID: 0x%06X</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">device_id</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">device_id</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Device ID read failed: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="-best-practices">
  
  
    <a href="#-best-practices" class="anchor-heading" aria-labelledby="-best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🧪 <strong>Best Practices</strong>
  
  
</h2>
    
<h3 id="-recommended-patterns">
  
  
    <a href="#-recommended-patterns" class="anchor-heading" aria-labelledby="-recommended-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ✅ <strong>Recommended Patterns</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="c1">// ✅ Always check initialization</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spi</span><span class="p">.</span><span class="n">EnsureInitialized</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"❌ SPI initialization failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ✅ Validate device configuration</span>
<span class="n">hf_spi_capabilities_t</span> <span class="n">caps</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">spi</span><span class="p">.</span><span class="n">GetCapabilities</span><span class="p">(</span><span class="n">caps</span><span class="p">)</span> <span class="o">==</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">device_id</span> <span class="o">&gt;=</span> <span class="n">caps</span><span class="p">.</span><span class="n">max_devices</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"❌ Device %u exceeds maximum (%u)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">caps</span><span class="p">.</span><span class="n">max_devices</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ✅ Use appropriate frequency for your application</span>
<span class="c1">// Sensors: 1-10 MHz</span>
<span class="c1">// Displays: 10-40 MHz</span>
<span class="c1">// Memory: 20-80 MHz</span>

<span class="c1">// ✅ Handle transfer errors gracefully</span>
<span class="n">hf_spi_err_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">spi</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"⚠️ SPI Error: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HfSpiErrToString</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
    <span class="c1">// Implement retry logic or error recovery</span>
<span class="p">}</span>

<span class="c1">// ✅ Use DMA for large transfers</span>
<span class="n">config</span><span class="p">.</span><span class="n">use_dma</span> <span class="o">=</span> <span class="p">(</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">);</span>  <span class="c1">// Use DMA for transfers &gt; 32 bytes</span>

<span class="c1">// ✅ Check device status before operations</span>
<span class="n">hf_spi_device_status_t</span> <span class="n">status</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">spi</span><span class="p">.</span><span class="n">GetDeviceStatus</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="o">==</span> <span class="n">hf_spi_err_t</span><span class="o">::</span><span class="n">SPI_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">.</span><span class="n">is_busy</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"⏳ Device %u is busy</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">device_id</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="-common-pitfalls">
  
  
    <a href="#-common-pitfalls" class="anchor-heading" aria-labelledby="-common-pitfalls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ❌ <strong>Common Pitfalls</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">// ❌ Don't ignore initialization</span>
<span class="n">spi</span><span class="p">.</span><span class="n">TransmitReceive</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tx_data</span><span class="p">,</span> <span class="n">rx_data</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>  <span class="c1">// May fail silently</span>

<span class="c1">// ❌ Don't use invalid frequencies</span>
<span class="n">spi</span><span class="p">.</span><span class="n">ConfigureDevice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="n">mode</span><span class="o">:</span> <span class="n">MODE_0</span><span class="p">,</span> <span class="n">frequency_hz</span><span class="o">:</span> <span class="mi">100000000</span><span class="p">});</span>  <span class="c1">// Too high</span>

<span class="c1">// ❌ Don't use invalid device numbers</span>
<span class="n">spi</span><span class="p">.</span><span class="n">ConfigureDevice</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span>  <span class="c1">// Invalid device</span>

<span class="c1">// ❌ Don't ignore transfer timeouts</span>
<span class="c1">// Large transfers may timeout - check return values</span>

<span class="c1">// ❌ Don't assume all modes are supported</span>
<span class="c1">// Check capabilities before using specific modes</span>

<span class="c1">// ❌ Don't forget to handle CS pin manually when needed</span>
<span class="c1">// Some devices require manual CS control</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="-performance-optimization">
  
  
    <a href="#-performance-optimization" class="anchor-heading" aria-labelledby="-performance-optimization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🎯 <strong>Performance Optimization</strong>
  
  
</h3>
    

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="c1">// 🚀 Use appropriate frequency for your application</span>
<span class="c1">// Higher frequency = faster transfers but may cause errors</span>

<span class="c1">// 🚀 Use DMA for large transfers</span>
<span class="c1">// DMA reduces CPU overhead for transfers &gt; 32 bytes</span>

<span class="c1">// 🚀 Minimize CS toggling</span>
<span class="c1">// Keep CS low for multiple transfers to the same device</span>

<span class="c1">// 🚀 Use appropriate data size</span>
<span class="c1">// 8-bit: Most common, good compatibility</span>
<span class="c1">// 16-bit: Faster for 16-bit data</span>
<span class="c1">// 32-bit: Fastest for 32-bit data</span>

<span class="c1">// 🚀 Batch operations when possible</span>
<span class="c1">// Configure all devices before starting transfers</span>

<span class="c1">// 🚀 Use appropriate timeout values</span>
<span class="c1">// Short timeouts for fast devices</span>
<span class="c1">// Longer timeouts for slow devices</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="-navigation">
  
  
    <a href="#-navigation" class="anchor-heading" aria-labelledby="-navigation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🔗 <strong>Navigation</strong>
  
  
</h2>
    
<h3 id="documentation-structure">
  
  
    <a href="#documentation-structure" class="anchor-heading" aria-labelledby="documentation-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Documentation Structure</strong>
  
  
</h3>
    

<ul>
  <li><strong><a href="/hf-internal-interface-wrap/development/docs/">🏠 Main Documentation</a></strong> - Complete system overview</li>
  <li><strong><a href="/hf-internal-interface-wrap/development/docs/api/">📋 API Interfaces</a></strong> - Base classes and interfaces overview</li>
  <li><strong><a href="/hf-internal-interface-wrap/development/docs/esp_api/">🔧 ESP32 Implementations</a></strong> - Hardware-specific implementations</li>
  <li><strong><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/">🧪 Test Suites</a></strong> - Testing and validation</li>
</ul>
<h3 id="related-documentation">
  
  
    <a href="#related-documentation" class="anchor-heading" aria-labelledby="related-documentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Related Documentation</strong>
  
  
</h3>
    

<ul>
  <li><strong><a href="/hf-internal-interface-wrap/development/docs/esp_api/EspSpi/">EspSpi Implementation</a></strong> - ESP32-C6 SPI implementation</li>
  <li><strong><a href="/hf-internal-interface-wrap/development/examples/esp32/docs/spi_test/">SPI Comprehensive Tests</a></strong> - Complete SPI validation</li>
  <li><strong><a href="/hf-internal-interface-wrap/development/docs/api/HardwareTypes/">Hardware Types</a></strong> - Type definitions and validation
<!-- markdownlint-disable-next-line MD013 --></li>
  <li><strong><a href="https://docs.espressif.com/projects/esp-idf/en/release-v5.5/esp32c6/api-reference/peripherals/spi_master.html">ESP-IDF SPI Master Driver</a></strong> - Official ESP-IDF docs</li>
</ul><hr />

          

          
            
          
        </main>
        

  <hr>
  <footer>
    

    <footer class="site-footer">
  <div class="site-footer-credits">
    <p>Built with ❤️ using <a href="https://just-the-docs.github.io/just-the-docs/">Just the Docs</a></p>
    <p><a href="https://github.com/n3b3x/hf-internal-interface-wrap/blob/main/LICENSE">GPL v3 License</a> • <a href="https://github.com/n3b3x/hf-internal-interface-wrap">View on GitHub</a></p>
  </div>
</footer>


    
  </footer>


      </div>
    </div>
    
      
<button id="search-button" class="search-button btn-reset" aria-label="Focus on search">
  <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-search"></use></svg>
</button>


<div class="search-overlay"></div>

    
  </div>

  
</body>
</html>

